#! /usr/bin/env python3
###############################################################################
#                                                                             #
# Copyright (C) 2017 Edward d'Auvergne                                        #
#                                                                             #
# This file is part of the program relax (http://www.nmr-relax.com).          #
#                                                                             #
# This program is free software: you can redistribute it and/or modify        #
# it under the terms of the GNU General Public License as published by        #
# the Free Software Foundation, either version 3 of the License, or           #
# (at your option) any later version.                                         #
#                                                                             #
# This program is distributed in the hope that it will be useful,             #
# but WITHOUT ANY WARRANTY; without even the implied warranty of              #
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the               #
# GNU General Public License for more details.                                #
#                                                                             #
# You should have received a copy of the GNU General Public License           #
# along with this program.  If not, see <http://www.gnu.org/licenses/>.       #
#                                                                             #
###############################################################################

# Python module imports.
from os import chdir, path
from shutil import rmtree
from subprocess import PIPE, Popen
import sys

# Script module imports.
from base_fns import exec_cmd


# The git-svn repositories.
GITSVN_REPO = "/data/relax/gna/repository_backup/git_migration/gitsvn_manual/repo_gitsvn_backup/"
CLEANUP_REPO = "repo_cleanup"

# Trunk branches.
TRUNK = [
    "0.1",
    "0.2",
    "0.3",
    "1.0",
    "1.1",
    "1.2",
    "1.3",
]

# All branches.
BRANCHES = [
    "2.2",
    "N_state_model",
    "R1_fitting",
    "absolute_rdc",
    "apply",
    "auto_select",
    "auto_select_merged",
    "ave_noe",
    "bieri_gui",
    "bmrb",
    "bruker_import",
    "c_modules",
    "consistency_tests_1.2",
    "consistency_tests_1.3",
    "cst",
    "cst_1.2.10",
    "diff_tensor",
    "diff_tensor_bug_5559_fix",
    "disp_speed",
    "disp_speed_compare",
    "disp_spin_speed",
    "double_rotor",
    "error_import",
    "est_par_error",
    "frame_order",
    "frame_order_cleanup",
    "frame_order_testing",
    "gui_testing",
    "home",
    "interatomic",
    "inversion-recovery",
    "j_couplings",
    "macraild",
    "mol_res_spin_module_rename",
    "multi_processor",
    "multi_processor_merge",
    "multi_structure",
    "nan_catch_test",
    "nmrglue",
    "peak_intensities",
    "peak_list_handling",
    "pipe_refs",
    "r1rho_plotting",
    "rdc_analysis",
    "rdc_analysis_old",
    "relax_data",
    "relax_data_rearrange",
    "relax_disp",
    "relax_disp_old",
    "relax_fit_c_class",
    "singleton_fixing",
    "space_mapping_refactor",
    "spec_api",
    "spectral_errors",
    "spin_loop_bool",
    "tensor_data",
    "tensor_pdb",
    "test_suite",
    "uf_redesign",
    "value_write_fixes",
    "warning",
    "xyz",
    "zooming_grid_search",
]

# All tags.
TAGS = [
  "1.0.0",
  "1.0.1",
  "1.0.10",
  "1.0.2",
  "1.0.3",
  "1.0.4",
  "1.0.5",
  "1.0.6",
  "1.0.7",
  "1.0.8",
  "1.0.9",
  "1.2.0",
  "1.2.1",
  "1.2.10",
  "1.2.11",
  "1.2.12",
  "1.2.13",
  "1.2.14",
  "1.2.15",
  "1.2.2",
  "1.2.3",
  "1.2.4",
  "1.2.5",
  "1.2.6",
  "1.2.7",
  "1.2.8",
  "1.2.9",
  "1.3.0",
  "1.3.1",
  "1.3.10",
  "1.3.11",
  "1.3.12",
  "1.3.13",
  "1.3.14",
  "1.3.15",
  "1.3.16",
  "1.3.2",
  "1.3.3",
  "1.3.4",
  "1.3.5",
  "1.3.6",
  "1.3.7",
  "1.3.8",
  "1.3.9",
  "2.0.0",
  "2.1.0",
  "2.1.1",
  "2.1.2",
  "2.1.3",
  "2.2.0",
  "2.2.1",
  "2.2.2",
  "2.2.3",
  "2.2.4",
  "2.2.5",
  "3.0.0",
  "3.0.1",
  "3.0.2",
  "3.1.0",
  "3.1.1",
  "3.1.2",
  "3.1.3",
  "3.1.4",
  "3.1.5",
  "3.1.6",
  "3.1.7",
  "3.2.0",
  "3.2.1",
  "3.2.2",
  "3.2.3",
  "3.3.0",
  "3.3.1",
  "3.3.2",
  "3.3.3",
  "3.3.4",
  "3.3.5",
  "3.3.6",
  "3.3.7",
  "3.3.8",
  "3.3.9",
  "4.0.0",
  "4.0.1",
  "4.0.2",
  "4.0.3",
  "mf_2001-12-16",
  "mf_2001-12-17",
  "mf_2001-12-17b",
  "mf_2001-12-19",
  "mf_2001-12-19b",
  "mf_2001-12-19c",
  "mf_2001-12-21",
  "mf_2002-01-03",
  "mf_2002-01-04",
  "mf_2002-01-04b",
  "mf_2002-01-08",
  "mf_2002-01-09",
  "mf_2002-01-09b",
  "mf_2002-01-09c",
  "mf_2002-01-14",
  "mf_2002-01-16",
  "mf_2002-01-16b",
  "mf_2002-01-23",
  "mf_2002-01-23b",
  "mf_2002-01-23c",
  "mf_2002-02-13",
  "mf_2002-03-07",
  "mf_2002-07-22",
  "mf_2002-07-24",
  "mf_2002-07-25",
  "mf_2002-07-25b",
  "mf_2002-07-26",
  "mf_2002-07-28",
  "mf_2002-09-14",
  "mf_2002-09-18",
  "mf_2002-09-19",
  "mf_2002-09-23",
  "mf_2002-10-01",
  "mf_2002-10-05",
  "mf_2002-10-16",
  "mf_2002-10-22",
  "mf_2002-10-22b",
  "mf_2002-10-22c",
  "mf_2002-10-23b",
  "mf_2002-10-24",
  "mf_2002-10-25",
  "mf_2003-01-06",
  "mf_2003-01-09",
  "mf_2003-01-13",
  "mf_2003-01-16",
  "mf_2003-01-17",
  "mf_2003-01-22",
  "mf_2003-01-23",
  "mf_2003-01-23b",
  "mf_2003-01-24",
  "mf_2003-01-24b",
  "mf_2003-01-27",
  "mf_2003-01-28",
  "mf_2003-01-29",
  "mf_2003-01-30",
  "mf_2003-01-31",
  "mf_2003-01-31b",
  "mf_2003-02-01",
  "mf_2003-02-04",
  "mf_2003-02-04b",
  "mf_2003-02-05",
  "mf_2003-02-06",
  "mf_2003-02-06b",
  "mf_2003-02-07",
  "modelfree_2001-11-1",
  "modelfree_2001-11-14",
  "modelfree_2001-11-16",
  "modelfree_2001-11-16b",
  "modelfree_2001-11-17",
  "modelfree_2001-11-17b",
  "modelfree_2001-11-18",
  "modelfree_2001-11-19",
  "modelfree_2001-11-19b",
  "modelfree_2001-11-20",
  "modelfree_2001-11-20b",
  "modelfree_2001-11-21",
  "modelfree_2001-12-09",
  "modelfree_2001-12-10",
  "modelfree_2001-12-15",
  "modelfree_2001-12-15b",
  "modelfree_merge_2001-12-15",
  "relax_2003-02-14",
  "relax_2003-02-16",
  "relax_2003-02-17",
  "relax_2003-02-19",
  "relax_2003-02-20",
  "relax_2003-02-20b",
  "relax_2003-02-21",
  "relax_2003-02-21b",
  "relax_2003-02-24",
  "relax_2003-02-24b",
  "relax_2003-02-25",
  "relax_2003-02-25b",
  "relax_2003-02-25c",
  "relax_2003-02-26",
  "relax_2003-02-27",
  "relax_2003-02-28",
  "relax_2003-03-03",
  "relax_2003-03-03b",
  "relax_2003-03-03c",
  "relax_2003-03-04",
  "relax_2003-03-05",
  "relax_2003-03-05b",
  "relax_2003-03-06",
  "relax_2003-03-07",
  "relax_2003-03-07b",
  "relax_2003-03-07c",
  "relax_2003-03-08",
  "relax_2003-03-09",
  "relax_2003-03-10",
  "relax_2003-03-10b",
  "relax_2003-03-10c",
  "relax_2003-03-11",
  "relax_2003-03-11b",
  "relax_2003-03-12",
  "relax_2003-03-13",
  "relax_2003-03-15",
  "relax_2003-03-17",
  "relax_2003-03-17b",
  "relax_2003-03-18",
  "relax_2003-03-18b",
  "relax_2003-03-18c",
  "relax_2003-03-19",
  "relax_2003-03-20",
  "relax_2003-03-20b",
  "relax_2003-03-21",
  "relax_2003-03-24",
  "relax_2003-03-24b",
  "relax_2003-03-28",
  "relax_2003-03-31",
  "relax_2003-04-01",
  "relax_2003-04-04",
  "relax_2003-04-07",
  "relax_2003-04-09",
  "relax_2003-04-11",
  "relax_2003-04-17",
  "relax_2003-05-05",
  "relax_2003-05-06",
  "relax_2003-05-06b",
  "relax_2003-05-07",
  "relax_2003-05-08",
  "relax_2003-05-09",
  "relax_2003-05-12",
  "relax_2003-05-13",
  "relax_2003-05-13b",
  "relax_2003-05-16",
  "relax_2003-05-20",
  "relax_2003-05-27",
  "relax_2003-06-06",
  "relax_2003-06-16",
  "relax_2003-06-16b",
  "relax_2003-06-16c",
  "relax_2003-06-17",
  "relax_2003-06-18",
  "relax_2003-06-19",
  "relax_2003-06-20",
  "relax_2003-06-22",
  "relax_2003-06-23",
  "relax_2003-06-24",
  "relax_2003-06-25",
  "relax_2003-06-26",
  "relax_2003-06-26b",
  "relax_2003-06-27",
  "relax_2003-06-27b",
  "relax_2003-07-02",
  "relax_2003-07-03",
  "relax_2003-07-03b",
  "relax_2003-07-04",
  "relax_2003-07-05",
  "relax_2003-07-07",
  "relax_2003-07-08",
  "relax_2003-07-08b",
  "relax_2003-07-09",
  "relax_2003-07-09b",
  "relax_2003-07-10",
  "relax_2003-07-10b",
  "relax_2003-07-11",
  "relax_2003-07-11b",
  "relax_2003-07-12",
  "relax_2003-07-14",
  "relax_2003-07-14b",
  "relax_2003-07-15",
  "relax_2003-07-16",
  "relax_2003-07-16b",
  "relax_2003-07-16c",
  "relax_2003-07-17",
  "relax_2003-07-18",
  "relax_2003-07-25",
  "relax_2003-07-25b",
  "relax_2003-07-28",
  "relax_2003-07-29",
  "relax_2003-07-29b",
  "relax_2003-07-30",
  "relax_2003-07-30b",
  "relax_2003-07-31",
  "relax_2003-08-01",
  "relax_2003-08-01b",
  "relax_2003-08-04",
  "relax_2003-08-04b",
  "relax_2003-08-05",
  "relax_2003-08-06",
  "relax_2003-08-07",
  "relax_2003-08-08",
  "relax_2003-08-11",
  "relax_2003-08-11b",
  "relax_2003-08-12",
  "relax_2003-08-12b",
  "relax_2003-08-13",
  "relax_2003-08-13b",
  "relax_2003-08-14",
  "relax_2003-08-15",
  "relax_2003-08-18",
  "relax_2003-08-19",
  "relax_2003-08-20",
  "relax_2003-08-25",
  "relax_2003-08-26",
  "relax_2003-08-28",
  "relax_2003-08-29",
  "relax_2003-08-29b",
  "relax_2003-08-31",
  "relax_2003-09-01",
  "relax_2003-09-02",
  "relax_2003-09-03",
  "relax_2003-09-05",
  "relax_2003-09-05b",
  "relax_2003-09-11",
  "relax_2003-09-15",
  "relax_2003-09-15b",
  "relax_2003-09-22",
  "relax_2003-09-23",
  "relax_2003-09-25",
  "relax_2003-09-29",
  "relax_2003-10-02",
  "relax_2003-10-03",
  "relax_2003-10-03a",
  "relax_2003-10-07",
  "relax_2003-10-08",
  "relax_2003-10-09",
  "relax_2003-10-09a",
  "relax_2003-10-10",
  "relax_2003-10-11",
  "relax_2003-10-12",
  "relax_2003-10-13",
  "relax_2003-10-13a",
  "relax_2003-10-14",
  "relax_2003-10-15",
  "relax_2003-10-17",
  "relax_2003-10-18",
  "relax_2003-10-19",
  "relax_2003-10-20",
  "relax_2003-10-22",
  "relax_2003-10-23",
  "relax_2003-10-23a",
  "relax_2003-10-30",
  "relax_2003-10-30a",
  "relax_2003-11-14",
  "relax_2003-11-15",
  "relax_2003-11-17",
  "relax_2003-11-18",
  "relax_2003-11-18a",
  "relax_2003-11-21",
  "relax_2003-12-20",
  "relax_2003-12-21",
  "relax_2003-12-21a",
  "relax_2003-12-22",
  "relax_2003-12-22a",
  "relax_2003-12-22b",
  "relax_2003-12-22c",
  "relax_2003-12-22d",
  "relax_2003-12-23",
  "relax_2003-12-29",
  "relax_2004-01-01",
  "relax_2004-01-03",
  "relax_2004-01-27",
  "relax_2004-01-27a",
  "relax_2004-02-23",
  "relax_2004-02-24",
  "relax_2004-02-24a",
  "relax_2004-02-25",
  "relax_2004-02-25a",
  "relax_2004-02-26",
  "relax_2004-02-26a",
  "relax_2004-02-27",
  "relax_2004-02-29",
  "relax_2004-03-01",
  "relax_2004-03-01a",
  "relax_2004-03-02",
  "relax_2004-03-02a",
  "relax_2004-03-03",
  "relax_2004-03-04",
  "relax_2004-03-05",
  "relax_2004-03-05a",
  "relax_2004-03-05b",
  "relax_2004-03-07",
  "relax_2004-03-07a",
  "relax_2004-03-09",
  "relax_2004-03-09a",
  "relax_2004-03-10",
  "relax_2004-03-11",
  "relax_2004-03-11a",
  "relax_2004-03-12",
  "relax_2004-03-12a",
  "relax_2004-03-12b",
  "relax_2004-03-15",
  "relax_2004-03-15a",
  "relax_2004-03-16",
  "relax_2004-03-21",
  "relax_2004-03-21a",
  "relax_2004-03-22",
  "relax_2004-03-22a",
  "relax_2004-03-22b",
  "relax_2004-03-25",
  "relax_2004-03-25a",
  "relax_2004-03-26",
  "relax_2004-03-29",
  "relax_2004-03-29a",
  "relax_2004-03-30",
  "relax_2004-03-30a",
  "relax_2004-03-31",
  "relax_2004-03-31a",
  "relax_2004-04-01",
  "relax_2004-04-01a",
  "relax_2004-04-02",
  "relax_2004-04-02a",
  "relax_2004-04-05",
  "relax_2004-04-05a",
  "relax_2004-04-05b",
  "relax_2004-04-06",
  "relax_2004-04-06a",
  "relax_2004-04-07",
  "relax_2004-04-07a",
  "relax_2004-04-07b",
  "relax_2004-04-07c",
  "relax_2004-04-08",
  "relax_2004-04-08a",
  "relax_2004-04-19",
  "relax_2004-04-20",
  "relax_2004-04-20a",
  "relax_2004-04-20b",
  "relax_2004-04-21",
  "relax_2004-04-25",
  "relax_2004-04-25a",
  "relax_2004-04-25b",
  "relax_2004-04-26",
  "relax_2004-04-27",
  "relax_2004-04-27a",
  "relax_2004-04-30",
  "relax_2004-05-01",
  "relax_2004-05-01a",
  "relax_2004-05-01b",
  "relax_2004-05-01c",
  "relax_2004-05-02",
  "relax_2004-05-02a",
  "relax_2004-05-02b",
  "relax_2004-05-02c",
  "relax_2004-05-03",
  "relax_2004-05-03a",
  "relax_2004-05-03b",
  "relax_2004-05-04",
  "relax_2004-05-04a",
  "relax_2004-05-08",
  "relax_2004-05-13",
  "relax_2004-05-18",
  "relax_2004-05-19",
  "relax_2004-05-25",
  "relax_2004-05-25a",
  "relax_2004-05-26",
  "relax_2004-05-27",
  "relax_2004-05-27a",
  "relax_2004-05-28",
  "relax_2004-05-29",
  "relax_2004-05-29a",
  "relax_2004-05-29b",
  "relax_2004-05-31",
  "relax_2004-05-31a",
  "relax_2004-06-01",
  "relax_2004-06-01a",
  "relax_2004-06-02",
  "relax_2004-06-02a",
  "relax_2004-06-03",
  "relax_2004-06-04",
  "relax_2004-06-04a",
  "relax_2004-06-05",
  "relax_2004-06-06",
  "relax_2004-06-07",
  "relax_2004-06-08",
  "relax_2004-06-08a",
  "relax_2004-06-10",
  "relax_2004-06-10a",
  "relax_2004-06-10b",
  "relax_2004-06-15",
  "relax_2004-06-16",
  "relax_2004-06-17",
  "relax_2004-06-18",
  "relax_2004-06-18a",
  "relax_2004-06-19",
  "relax_2004-06-20",
  "relax_2004-06-21",
  "relax_2004-06-22",
  "relax_2004-06-24",
  "relax_2004-06-25",
  "relax_2004-06-25a",
  "relax_2004-06-28",
  "relax_2004-06-28a",
  "relax_2004-06-29",
  "relax_2004-06-29a",
  "relax_2004-06-30",
  "relax_2004-06-30a",
  "relax_2004-07-01",
  "relax_2004-07-19",
  "relax_2004-07-20",
  "relax_2004-07-20a",
  "relax_2004-07-21",
  "relax_2004-07-22",
  "relax_2004-07-23",
  "relax_2004-07-26",
  "relax_2004-07-27",
  "relax_2004-07-29",
  "relax_2004-07-29a",
  "relax_2004-08-03",
  "relax_2004-08-08",
  "relax_2004-08-10",
  "relax_2004-08-10a",
  "relax_2004-08-11",
  "relax_2004-08-12",
  "relax_2004-08-17",
  "relax_2004-08-18",
  "relax_2004-08-19",
  "relax_2004-08-19a",
  "relax_2004-08-21",
  "relax_2004-08-21a",
  "relax_2004-08-22",
  "relax_2004-08-22a",
  "relax_2004-08-22b",
  "relax_2004-08-22c",
  "relax_2004-08-23",
  "relax_2004-08-24",
  "relax_2004-08-25",
  "relax_2004-08-26",
  "relax_2004-08-26a",
  "relax_2004-08-27",
  "relax_2004-08-28",
  "relax_2004-08-28a",
  "relax_2004-08-30",
  "relax_2004-09-02",
  "relax_2004-09-03",
  "relax_2004-09-03a",
  "relax_2004-09-06",
  "relax_2004-09-08",
  "relax_2004-09-08a",
  "relax_2004-09-09",
  "relax_2004-09-10",
  "relax_2004-09-10a",
  "relax_2004-09-10b",
  "relax_2004-09-10c",
  "relax_2004-09-10d",
  "relax_2004-09-10e",
  "relax_2004-09-13",
  "relax_2004-09-14",
  "relax_2004-09-15",
  "relax_2004-09-15a",
  "relax_2004-09-21",
  "relax_2004-09-21a",
  "relax_2004-09-22",
  "relax_2004-09-24",
  "relax_2004-09-28",
  "relax_2004-10-05",
  "relax_2004-10-06",
  "relax_2004-10-06a",
  "relax_2004-10-07",
  "relax_2004-10-07a",
  "relax_2004-10-11",
  "relax_2004-10-12",
  "relax_2004-10-12a",
  "relax_2004-10-14",
  "relax_2004-10-15",
  "relax_2004-10-18",
  "relax_2004-10-19",
  "relax_2004-10-19a",
  "relax_2004-10-19b",
  "relax_2004-10-27",
  "relax_2004-10-28",
  "relax_2004-10-29",
  "relax_2004-10-29a",
  "relax_2004-11-02",
  "relax_2004-11-03",
  "relax_2004-11-07",
  "relax_2004-11-07a",
  "relax_2004-11-08",
  "relax_2004-11-09",
  "relax_2004-11-09a",
  "relax_2004-11-09b",
  "relax_2004-11-10",
  "relax_2004-11-10a",
  "relax_2004-11-11",
  "relax_2004-11-11a",
  "relax_2004-11-11b",
  "relax_2004-11-12",
  "relax_2004-11-12a",
  "relax_2004-11-14",
  "relax_2004-11-15",
  "relax_2004-11-15a",
  "relax_2004-11-15b",
  "relax_2004-11-15c",
  "relax_2004-11-18",
  "relax_2004-11-19",
  "relax_2004-11-21",
  "relax_2004-11-21a",
  "relax_2004-11-24",
  "relax_2004-11-30",
  "relax_2004-11-30a",
  "relax_2004-11-30b",
  "relax_2004-11-30c",
  "relax_2004-11-30d",
  "relax_2004-12-01",
  "relax_2004-12-02",
  "relax_2004-12-02a",
  "relax_2004-12-02b",
  "relax_2004-12-03",
  "relax_2004-12-03a",
  "relax_2004-12-10",
  "relax_2004-12-11",
  "relax_2004-12-12",
  "relax_2004-12-12a",
  "relax_2004-12-12b",
  "relax_2004-12-12c",
  "relax_2004-12-12d",
  "relax_2004-12-13",
  "relax_2004-12-13a",
  "relax_2004-12-13b",
  "relax_2004-12-14",
  "relax_2004-12-14a",
  "relax_2004-12-14b",
  "relax_2004-12-14c",
  "relax_2004-12-14d",
  "relax_2004-12-14e",
  "relax_2004-12-14f",
  "relax_2004-12-14g",
  "relax_2004-12-14h",
  "relax_2004-12-15",
  "relax_2004-12-15a",
  "relax_2004-12-15b",
  "relax_2004-12-16",
  "relax_2004-12-16a",
  "relax_2004-12-16b",
  "relax_2004-12-16c",
  "relax_2004-12-16d",
  "relax_2004-12-16e",
  "relax_2004-12-17",
  "relax_2004-12-17a",
  "relax_2004-12-20",
  "relax_2004-12-20a",
  "relax_2004-12-21",
  "relax_2004-12-21a",
  "relax_2004-12-21b",
  "relax_2005-01-24",
  "relax_2005-03-22",
  "relax_2005-03-30",
  "relax_2005-03-30a",
  "relax_2005-04-01",
  "relax_2005-04-29",
  "relax_2005-05-06",
  "relax_2005-05-21",
  "relax_2005-05-30",
  "relax_2005-05-31",
  "relax_2005-06-14",
  "relax_2005-06-14a",
]


# Copy the repository.
rmtree(CLEANUP_REPO)
exec_cmd("cp -urp %s %s" % (GITSVN_REPO, CLEANUP_REPO))
chdir(CLEANUP_REPO)

# Check out the trunk and all branches.
for trunk in TRUNK:
    exec_cmd("git checkout -b %s origin/%s_svn" % (trunk, trunk))
exec_cmd("git branch -D master")
exec_cmd("git checkout -b master origin/trunk")
for branch in BRANCHES:
    exec_cmd("git checkout -b %s origin/%s" % (branch, branch))

# Initially check out all tags as branches.
for tag in TAGS:
    exec_cmd("git checkout -b tags/%s origin/tags/%s" % (tag, tag))
exec_cmd("git checkout master")

# Convert tag branches to git tags.
exec_cmd("git for-each-ref --format='%(refname)' refs/heads/tags | cut -d / -f 4 | while read ref; do   git tag \"$ref\" \"refs/heads/tags/$ref\";   git branch -D \"tags/$ref\"; done")

# Delete all "remote/origin/*" refs.
exec_cmd("git for-each-ref --format=\"%(refname)\" refs/remotes/origin/ | xargs -n 1 git update-ref -d")

# Remove branch saving commits and other head junk.
for branch in ['1.3', 'cst_1.2.10', 'multi_processor', 'relax_disp_old', 'rdc_analysis_old']:
    exec_cmd("git checkout %s" % branch)
    exec_cmd("git reset --hard HEAD^")
exec_cmd("git checkout master")

# Cleanup.
exec_cmd("git reflog expire --expire=now --all")
exec_cmd("git gc --prune=now")
